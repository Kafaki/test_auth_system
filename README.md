# Custom Authentication & RBAC System (Django + DRF + JWT)

Кастомная система аутентификации и авторизации без использования `django.contrib.auth`.  
Реализованы: регистрация, JWT-аутентификация, роли (RBAC), правила доступа, административное API, мягкое удаление пользователей и полный цикл проверки прав.

## Функциональность

1. **Регистрация и авторизация** (JWT, срок токена — 24 часа)
2. **Middleware-аутентификация** (обработка JWT до попадания в view)
3. **Профиль пользователя**: просмотр, изменение, смена пароля
4. **Мягкая деактивация пользователя** (`is_active=False`)
5. **Ролевая модель (RBAC)**: Role → BusinessElement → AccessRoleRule
6. **Административное API**: управление пользователями, ролями и правами
7. **Защита эндпоинтов** через `AccessControlMixin` и `check_permission`

## Технологии

- Python 3.13
- Django 5
- Django REST Framework
- PostgreSQL
- PyJWT / bcrypt
- Docker / Docker Compose

Система аутентификации и авторизации реализована полностью вручную.

## Ключевые компоненты:

- **JWTUserMiddleware** — верификация токена и подстановка `request.user`
- **BaseJWTAPIView** — замена DRF-аутентификации, единая точка входа
- **AccessControlMixin** — проверка прав (RBAC) для любых действий
- **RBAC-модели** — хранение ролей, элементов и правил доступа

## Установка и запуск

1. Создать файл окружения: `cp .env.example .env`
2. Запуск в Docker: `docker compose up --build`

После запуска автоматически выполняются:
- Миграции
- Загрузка фикстур RBAC
- Создание тестовых пользователей

Приложение будет доступно по адресу: http://localhost:8000

## Демо-пользователи

| Роль     | Email               | Пароль  | Описание                    |
|----------|---------------------|---------|-----------------------------|
| Admin    | admin@test.com      | Test123 | Полный доступ               |
| Manager  | manager@test.com    | Test123 | CRUD без удаления           |
| User1    | user1@example.com   | Test123 | Доступ только к себе        |
| User2    | user2@example.com   | Test123 | Доступ только к себе        |
| User3    | user3@example.com   | Test123 | Доступ только к себе        |
| Guest    | guest@example.com   | Test123 | Минимальные права           |

## Демо-пользователи

| Роль    | Email             | Пароль | Описание          |
|---------|-------------------|--------|-------------------|
| Admin   | admin@test.com    | Test123| Полный доступ     |
| Manager | manager@test.com  | Test123| CRUD без удаления |
| User1   | user1@example.com | Test123| Только свои данные|
| User2   | user2@example.com | Test123| Только свои данные|
| User3   | user3@example.com | Test123| Только свои данные|
| Guest   | guest@example.com | Test123| Минимальные права |


## Основные эндпоинты

### Пользовательские эндпоинты (`/api/users/`)

| Метод   | URL                     | Назначение                         |
|---------|-------------------------|------------------------------------|
| POST    | `/register/`            | Регистрация пользователя           |
| POST    | `/login/`               | Авторизация, получение JWT         |
| POST    | `/logout/`              | Выход из системы                   |
| GET     | `/profile/`             | Просмотр профиля пользователя      |
| PATCH   | `/profile/`             | Изменение профиля пользователя     |
| POST    | `/change-password/`     | Смена пароля                       |
| DELETE  | `/deactivate/`          | Мягкое удаление аккаунта           |

### Административные эндпоинты (`/api/admin/users/`)

| Метод   | URL        | Требование RBAC              |
|---------|------------|------------------------------|
| GET     | `/`        | `read_all`                   |
| POST    | `/`        | `create`                     |
| GET     | `/{id}/`   | `read` / `read_all`          |
| PATCH   | `/{id}/`   | `update` / `update_all`      |
| DELETE  | `/{id}/`   | `delete` / `delete_all`      |

### Управление ролями и доступом (`/api/rbac/`)

- `/roles/` — список ролей
- `/elements/` — список бизнес-элементов
- `/rules/` — просмотр и управление правилами доступа

## Документация

Подробное описание проекта доступно в файле: `Описание проекта.docx`

## Заключение

Проект демонстрирует создание собственной системы аутентификации и авторизации на Django без встроенных механизмов.  
Реализованы JWT, RBAC, административное API, мягкое удаление и полноценная безопасность уровня приложений.  
